# 服务端技术文档大纲

## 文档说明
本文档是 Cube 项目服务端的技术文档大纲，定义了服务端的整体架构、各模块职责和实现细节。

**服务端架构**：
- **HTTP Server**：处理登录、商城、购买、公告等非实时业务
- **TCP Server**：处理位移、战斗等实时游戏逻辑

---

## 目录结构

```
doc/服务端技术文档/
├── 大纲.md                          # 本文档
├── 01-架构设计/
│   ├── 01-整体架构.md
│   ├── 02-HTTP-Server架构.md
│   ├── 03-TCP-Server架构.md
│   ├── 04-服务间通信.md
│   └── 05-技术选型.md
├── 02-HTTP-Server/
│   ├── 01-认证系统.md
│   ├── 02-商城系统.md
│   ├── 03-购买系统.md
│   ├── 04-公告系统.md
│   ├── 05-用户管理.md
│   ├── 06-数据统计.md
│   └── 07-API文档.md
├── 03-TCP-Server/
│   ├── 01-连接管理.md
│   ├── 02-位移系统.md
│   ├── 03-战斗系统.md
│   ├── 04-房间管理.md
│   ├── 05-匹配系统.md
│   ├── 06-状态同步.md
│   └── 07-协议定义.md
├── 04-数据库设计/
│   ├── 01-数据库选型.md
│   ├── 02-表结构设计.md
│   ├── 03-缓存设计.md
│   └── 04-数据迁移.md
├── 05-网络协议/
│   ├── 01-HTTP-API协议.md
│   ├── 02-TCP消息协议.md
│   ├── 03-序列化方案.md
│   └── 04-加密方案.md
├── 06-部署运维/
│   ├── 01-部署架构.md
│   ├── 02-配置管理.md
│   ├── 03-监控告警.md
│   └── 04-日志管理.md
└── 07-开发指南/
    ├── 01-开发环境搭建.md
    ├── 02-代码规范.md
    ├── 03-测试指南.md
    └── 04-调试技巧.md
```

---

## 第一部分：架构设计

### 1.1 整体架构

**文档路径**：`01-架构设计/01-整体架构.md`

**主要内容**：
- 服务端整体架构图
- HTTP Server 与 TCP Server 的职责划分
- 服务间的交互方式
- 数据流向图
- 扩展性设计

**关键点**：
```
客户端
  ↓
  ├── HTTP Server（非实时业务）
  │   ├── 用户认证
  │   ├── 商城购买
  │   ├── 公告查询
  │   └── 数据统计
  │
  └── TCP Server（实时游戏）
      ├── 位移同步
      ├── 战斗逻辑
      ├── 房间管理
      └── 状态同步

数据库层（PostgreSQL + Redis + MongoDB）
```

---

### 1.2 HTTP Server 架构

**文档路径**：`01-架构设计/02-HTTP-Server架构.md`

**主要内容**：
- ASP.NET Core Web API 架构
- RESTful API 设计原则
- 中间件管道设计
- 身份认证和授权（JWT）
- 错误处理和日志记录

**模块划分**：
```
HTTP Server
├── Controllers/          # 控制器层
│   ├── AuthController   # 认证接口
│   ├── ShopController   # 商城接口
│   ├── PaymentController # 支付接口
│   ├── NoticeController # 公告接口
│   └── UserController   # 用户接口
├── Services/            # 业务逻辑层
├── Repositories/        # 数据访问层
├── Middlewares/         # 中间件
└── Models/              # 数据模型
```

---

### 1.3 TCP Server 架构

**文档路径**：`01-架构设计/03-TCP-Server架构.md`

**主要内容**：
- 自定义 TCP 服务器架构
- 长连接管理
- 消息队列和处理
- 多线程/异步模型
- 心跳机制

**模块划分**：
```
TCP Server
├── Network/             # 网络层
│   ├── ConnectionManager # 连接管理
│   ├── MessageHandler   # 消息处理
│   └── HeartbeatManager # 心跳管理
├── Game/                # 游戏逻辑层
│   ├── Movement/        # 位移系统
│   ├── Combat/          # 战斗系统
│   ├── Room/            # 房间系统
│   └── Match/           # 匹配系统
├── Protocol/            # 协议层
│   ├── Serialization    # 序列化
│   └── MessageTypes     # 消息定义
└── State/               # 状态管理
    └── StateSync        # 状态同步
```

---

### 1.4 服务间通信

**文档路径**：`01-架构设计/04-服务间通信.md`

**主要内容**：
- HTTP Server 与 TCP Server 的通信方式
- 共享数据库方案
- Redis 作为消息中间件
- 事件驱动架构
- 数据一致性保证

**通信场景**：
- 用户登录后，HTTP Server 通知 TCP Server 在线状态
- 用户购买道具后，HTTP Server 更新数据库，TCP Server 推送道具
- TCP Server 上报战斗数据，HTTP Server 更新统计

---

### 1.5 技术选型

**文档路径**：`01-架构设计/05-技术选型.md`

**主要内容**：
| 技术组件 | 选型 | 用途 | 理由 |
|---------|------|------|------|
| HTTP框架 | ASP.NET Core | Web API | 性能优秀、跨平台 |
| TCP框架 | 自研/SuperSocket | 游戏服务器 | 可控性强 |
| 数据库 | PostgreSQL | 关系数据 | 功能强大、开源 |
| 缓存 | Redis | 缓存/消息 | 高性能 |
| 文档数据库 | MongoDB | 日志/记录 | 灵活schema |
| ORM | Entity Framework Core | 数据访问 | 官方支持 |
| 序列化 | Protobuf | 消息序列化 | 高效 |
| 日志 | Serilog | 日志记录 | 结构化日志 |

---

## 第二部分：HTTP Server 详细设计

### 2.1 认证系统

**文档路径**：`02-HTTP-Server/01-认证系统.md`

**主要内容**：

#### 功能模块
- 用户注册
- 用户登录
- Token 刷新
- 密码找回
- 第三方登录（可选）

#### API 接口
```
POST /api/auth/register      # 注册
POST /api/auth/login         # 登录
POST /api/auth/refresh       # 刷新Token
POST /api/auth/logout        # 登出
POST /api/auth/forgot        # 忘记密码
```

#### JWT Token 设计
```csharp
{
  "sub": "user_id",
  "name": "username",
  "role": "player",
  "exp": 1234567890,
  "iat": 1234567890
}
```

#### 安全措施
- 密码加密（BCrypt）
- Token 过期机制
- Refresh Token 轮转
- 防暴力破解（限流）
- IP 白名单（管理接口）

---

### 2.2 商城系统

**文档路径**：`02-HTTP-Server/02-商城系统.md`

**主要内容**：

#### 功能模块
- 商品列表查询
- 商品详情查询
- 商品分类管理
- 热门推荐
- 限时优惠

#### 数据模型
```csharp
class ShopItem
{
    int ItemId;           // 商品ID
    string Name;          // 商品名称
    string Description;   // 描述
    int Price;            // 价格
    string Currency;      // 货币类型
    int Stock;            // 库存（-1为无限）
    DateTime StartTime;   // 上架时间
    DateTime EndTime;     // 下架时间
    string Category;      // 分类
    string IconUrl;       // 图标URL
}
```

#### API 接口
```
GET  /api/shop/items           # 获取商品列表
GET  /api/shop/items/{id}      # 获取商品详情
GET  /api/shop/categories      # 获取分类列表
GET  /api/shop/recommend       # 获取推荐商品
GET  /api/shop/hot             # 获取热门商品
```

---

### 2.3 购买系统

**文档路径**：`02-HTTP-Server/03-购买系统.md`

**主要内容**：

#### 功能模块
- 订单创建
- 订单支付
- 订单查询
- 订单退款
- 购买历史

#### 购买流程
```
1. 客户端请求购买
2. 服务端验证库存
3. 创建订单（待支付）
4. 扣除虚拟货币/调用支付接口
5. 发放道具
6. 更新订单状态（已完成）
7. 通知客户端
```

#### 订单状态机
```
待支付 → 支付中 → 已支付 → 已发货 → 已完成
   ↓       ↓
已取消   已退款
```

#### API 接口
```
POST /api/purchase/create      # 创建订单
POST /api/purchase/pay         # 支付订单
GET  /api/purchase/orders      # 查询订单列表
GET  /api/purchase/orders/{id} # 查询订单详情
POST /api/purchase/refund      # 申请退款
```

#### 事务处理
- 数据库事务保证原子性
- 分布式锁防止超卖
- 幂等性设计防止重复扣款

---

### 2.4 公告系统

**文档路径**：`02-HTTP-Server/04-公告系统.md`

**主要内容**：

#### 功能模块
- 公告发布（管理后台）
- 公告列表查询
- 公告详情查询
- 弹窗公告
- 版本更新通知

#### 公告类型
- 系统公告
- 活动公告
- 维护公告
- 版本更新
- 紧急通知

#### API 接口
```
GET  /api/notice/list          # 获取公告列表
GET  /api/notice/{id}          # 获取公告详情
GET  /api/notice/popup         # 获取弹窗公告
POST /api/notice/create        # 创建公告（管理）
PUT  /api/notice/{id}          # 更新公告（管理）
DELETE /api/notice/{id}        # 删除公告（管理）
```

---

### 2.5 用户管理

**文档路径**：`02-HTTP-Server/05-用户管理.md`

**主要内容**：

#### 功能模块
- 用户信息查询
- 用户信息修改
- 角色管理
- 背包管理
- 好友系统

#### API 接口
```
GET  /api/user/profile         # 获取用户信息
PUT  /api/user/profile         # 更新用户信息
GET  /api/user/characters      # 获取角色列表
POST /api/user/characters      # 创建角色
GET  /api/user/inventory       # 获取背包
GET  /api/user/friends         # 获取好友列表
```

---

### 2.6 数据统计

**文档路径**：`02-HTTP-Server/06-数据统计.md`

**主要内容**：

#### 统计指标
- 用户活跃度
- 游戏时长
- 付费数据
- 关卡通过率
- 角色使用率

#### API 接口
```
GET /api/stats/daily           # 每日统计
GET /api/stats/user/{id}       # 用户统计
GET /api/stats/game            # 游戏统计
```

---

### 2.7 HTTP API 文档

**文档路径**：`02-HTTP-Server/07-API文档.md`

**主要内容**：
- 完整的 API 接口列表
- 请求参数说明
- 响应格式定义
- 错误码定义
- 使用示例

#### 统一响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": { },
  "timestamp": 1234567890
}
```

#### 统一错误码
| 错误码 | 说明 |
|-------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |
| 1001 | 用户名已存在 |
| 1002 | 密码错误 |
| 2001 | 库存不足 |
| 2002 | 余额不足 |

---

## 第三部分：TCP Server 详细设计

### 3.1 连接管理

**文档路径**：`03-TCP-Server/01-连接管理.md`

**主要内容**：

#### 功能模块
- 连接建立
- 连接认证
- 连接保持（心跳）
- 连接断开
- 重连机制

#### 连接流程
```
1. 客户端发起 TCP 连接
2. 服务端分配连接 ID
3. 客户端发送认证消息（包含 HTTP Token）
4. 服务端验证 Token
5. 建立会话，绑定用户 ID
6. 开始心跳检测
```

#### 心跳机制
```csharp
// 客户端每 30 秒发送心跳
Message: { Type: Heartbeat, Timestamp: xxx }

// 服务端响应心跳
Message: { Type: HeartbeatAck, Timestamp: xxx }

// 超过 90 秒未收到心跳，断开连接
```

#### 连接管理器设计
```csharp
class ConnectionManager
{
    Dictionary<int, Connection> connections;
    
    void OnConnect(Socket socket);
    void OnAuthenticate(int connId, string token);
    void OnDisconnect(int connId);
    void OnHeartbeat(int connId);
    void Broadcast(Message msg);
    void SendTo(int userId, Message msg);
}
```

---

### 3.2 位移系统

**文档路径**：`03-TCP-Server/02-位移系统.md`

**主要内容**：

#### 功能模块
- 玩家移动
- 位置同步
- 碰撞检测
- 导航寻路

#### 同步策略
- **客户端预测**：客户端立即响应输入
- **服务器权威**：服务器验证并广播位置
- **插值平滑**：其他客户端平滑显示
- **延迟补偿**：服务器回溯验证

#### 消息定义
```csharp
// 客户端 → 服务器
class MoveRequest
{
    int PlayerId;
    Vector3 TargetPosition;
    float Speed;
    long Timestamp;
}

// 服务器 → 客户端
class MoveSync
{
    int PlayerId;
    Vector3 Position;
    Vector3 Velocity;
    long ServerTime;
}
```

#### 同步频率
- 移动时：20 次/秒
- 静止时：不同步

#### 优化措施
- 只同步变化的位置
- 使用差值压缩
- AOI（Area of Interest）优化

---

### 3.3 战斗系统

**文档路径**：`03-TCP-Server/03-战斗系统.md`

**主要内容**：

#### 功能模块
- 技能释放
- 伤害计算
- Buff/Debuff 管理
- 战斗结算

#### 战斗流程
```
1. 客户端请求释放技能
2. 服务器验证：
   - 技能是否在CD
   - 蓝量是否足够
   - 目标是否合法
   - 距离是否足够
3. 服务器执行技能效果
4. 计算伤害
5. 应用伤害到目标
6. 广播战斗事件
7. 检查死亡
8. 结算奖励
```

#### 消息定义
```csharp
// 技能释放请求
class SkillCastRequest
{
    int SkillId;
    int TargetId;
    Vector3 TargetPosition;
}

// 技能释放响应
class SkillCastEvent
{
    int CasterId;
    int SkillId;
    int TargetId;
    int Damage;
    List<Effect> Effects;
}

// 伤害事件
class DamageEvent
{
    int AttackerId;
    int VictimId;
    int Damage;
    bool IsCritical;
}
```

#### 伤害计算公式
```csharp
// 基础伤害
float baseDamage = skill.BaseDamage + attacker.Attack;

// 防御减免
float defense = target.Defense;
float damageReduction = defense / (defense + 100);
float actualDamage = baseDamage * (1 - damageReduction);

// 暴击
if (Random < attacker.CritRate)
{
    actualDamage *= attacker.CritDamage;
}

// 应用
target.HP -= actualDamage;
```

---

### 3.4 房间管理

**文档路径**：`03-TCP-Server/04-房间管理.md`

**主要内容**：

#### 功能模块
- 房间创建
- 房间加入
- 房间离开
- 房间列表
- 房间配置

#### 房间生命周期
```
创建 → 等待中 → 准备中 → 游戏中 → 结算中 → 销毁
```

#### 房间类型
- 匹配房间（自动匹配）
- 自建房间（好友房）
- 训练房间（单人/AI）

#### 房间数据结构
```csharp
class Room
{
    int RoomId;
    string RoomName;
    RoomType Type;
    RoomState State;
    int MaxPlayers;
    List<Player> Players;
    RoomConfig Config;
    DateTime CreateTime;
    
    void AddPlayer(Player player);
    void RemovePlayer(int playerId);
    void Start();
    void End();
}
```

#### API 消息
```csharp
// 创建房间
class CreateRoomRequest
{
    string RoomName;
    int MaxPlayers;
    RoomConfig Config;
}

// 加入房间
class JoinRoomRequest
{
    int RoomId;
}

// 房间列表
class RoomListResponse
{
    List<RoomInfo> Rooms;
}
```

---

### 3.5 匹配系统

**文档路径**：`03-TCP-Server/05-匹配系统.md`

**主要内容**：

#### 功能模块
- 快速匹配
- 排位匹配
- 组队匹配
- 匹配取消

#### 匹配算法
```
1. 玩家加入匹配队列
2. 按评分范围查找对手
3. 范围随等待时间扩大
4. 匹配成功后创建房间
5. 通知所有玩家
```

#### ELO 评分系统
```csharp
// 期望胜率
float expected = 1 / (1 + pow(10, (opponentRating - playerRating) / 400));

// 评分变化
float K = 32; // K因子
float change = K * (actualScore - expected);

// 更新评分
newRating = oldRating + change;
```

#### 匹配队列管理
```csharp
class MatchQueue
{
    PriorityQueue<MatchRequest> queue;
    
    void Enqueue(Player player);
    void Dequeue(Player player);
    void TryMatch();
}
```

---

### 3.6 状态同步

**文档路径**：`03-TCP-Server/06-状态同步.md`

**主要内容**：

#### 同步策略
- **状态同步**：同步游戏状态（位置、HP等）
- **帧同步**：同步玩家输入（备选方案）

#### 同步内容
- 玩家位置和速度
- 玩家生命值、蓝量
- 技能冷却状态
- Buff/Debuff 列表
- 游戏事件（击杀、得分）

#### 同步频率
- 高频状态（位置）：20-30 次/秒
- 中频状态（HP）：10 次/秒
- 低频状态（等级）：变化时同步

#### 优化技术
```
1. 状态压缩
   - 位置：使用短整型（精度损失可接受）
   - 方向：使用字节存储（360度分256份）
   
2. 增量同步
   - 只同步变化的字段
   - 使用脏标记

3. 插值和预测
   - 客户端插值平滑显示
   - 客户端预测自己的移动

4. AOI 优化
   - 只同步视野内的对象
```

---

### 3.7 协议定义

**文档路径**：`03-TCP-Server/07-协议定义.md`

**主要内容**：

#### 消息格式
```
[Header] [Body]

Header (8 bytes):
- MessageLength (4 bytes): 消息总长度
- MessageType   (2 bytes): 消息类型
- Sequence      (2 bytes): 序列号

Body:
- Protobuf 序列化的消息内容
```

#### 消息类型定义
```csharp
enum MessageType
{
    // 连接相关 (1000-1099)
    Heartbeat = 1000,
    HeartbeatAck = 1001,
    Authenticate = 1002,
    AuthenticateAck = 1003,
    
    // 房间相关 (2000-2099)
    CreateRoom = 2000,
    JoinRoom = 2001,
    LeaveRoom = 2002,
    RoomList = 2003,
    
    // 匹配相关 (2100-2199)
    StartMatch = 2100,
    CancelMatch = 2101,
    MatchSuccess = 2102,
    
    // 游戏相关 (3000-3099)
    GameStart = 3000,
    GameEnd = 3001,
    
    // 移动相关 (3100-3199)
    MoveRequest = 3100,
    MoveSync = 3101,
    
    // 战斗相关 (3200-3299)
    SkillCast = 3200,
    SkillHit = 3201,
    Damage = 3202,
    Death = 3203,
    
    // 状态相关 (3300-3399)
    StateSync = 3300,
    BuffAdd = 3301,
    BuffRemove = 3302,
}
```

#### Protobuf 定义示例
```protobuf
syntax = "proto3";

message MoveRequest {
    int32 player_id = 1;
    Vector3 target_position = 2;
    float speed = 3;
    int64 timestamp = 4;
}

message Vector3 {
    float x = 1;
    float y = 2;
    float z = 3;
}
```

---

## 第四部分：数据库设计

### 4.1 数据库选型

**文档路径**：`04-数据库设计/01-数据库选型.md`

**主要内容**：

| 数据库 | 用途 | 存储内容 |
|--------|------|---------|
| PostgreSQL | 关系数据 | 用户、角色、订单、商品 |
| Redis | 缓存/会话 | Session、排行榜、在线用户 |
| MongoDB | 文档数据 | 游戏日志、战斗记录 |

---

### 4.2 表结构设计

**文档路径**：`04-数据库设计/02-表结构设计.md`

**主要内容**：

#### 用户表（users）
```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    salt VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    is_banned BOOLEAN DEFAULT FALSE
);
```

#### 角色表（characters）
```sql
CREATE TABLE characters (
    character_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    character_name VARCHAR(50) NOT NULL,
    character_type INT NOT NULL,
    level INT DEFAULT 1,
    experience BIGINT DEFAULT 0,
    hp INT NOT NULL,
    mp INT NOT NULL,
    attack INT NOT NULL,
    defense INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_played TIMESTAMP
);
```

#### 背包表（inventory）
```sql
CREATE TABLE inventory (
    inventory_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    item_id INT NOT NULL,
    quantity INT DEFAULT 1,
    acquired_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 订单表（orders）
```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    item_id INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    currency VARCHAR(10) NOT NULL,
    status VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    paid_at TIMESTAMP,
    completed_at TIMESTAMP
);
```

#### 游戏记录表（game_records）
```sql
CREATE TABLE game_records (
    record_id SERIAL PRIMARY KEY,
    room_id INT NOT NULL,
    game_mode VARCHAR(50) NOT NULL,
    player_ids INT[] NOT NULL,
    winner_ids INT[],
    duration INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

### 4.3 缓存设计

**文档路径**：`04-数据库设计/03-缓存设计.md`

**主要内容**：

#### Redis 数据结构

**在线用户**（Set）
```
Key: online_users
Value: Set<user_id>
TTL: 永久（定期清理）
```

**用户会话**（String）
```
Key: session:{user_id}
Value: {token, login_time, device}
TTL: 7200 秒（2小时）
```

**排行榜**（Sorted Set）
```
Key: leaderboard:rating
Value: ZSet<user_id, rating>
TTL: 永久
```

**匹配队列**（List）
```
Key: match_queue:{game_mode}
Value: List<{user_id, rating, join_time}>
TTL: 600 秒（10分钟）
```

#### 缓存策略
- **Cache-Aside**：读取时先查缓存，未命中则查数据库并写入缓存
- **Write-Through**：写入时同时更新缓存和数据库
- **TTL 设置**：根据数据重要性设置过期时间

---

### 4.4 数据迁移

**文档路径**：`04-数据库设计/04-数据迁移.md`

**主要内容**：
- Entity Framework Core Migrations
- 迁移脚本管理
- 数据备份和恢复
- 版本兼容性

---

## 第五部分：网络协议

### 5.1 HTTP API 协议

**文档路径**：`05-网络协议/01-HTTP-API协议.md`

**主要内容**：
- RESTful API 设计规范
- 统一请求/响应格式
- 认证方式（Bearer Token）
- 版本管理（/api/v1/）

---

### 5.2 TCP 消息协议

**文档路径**：`05-网络协议/02-TCP消息协议.md`

**主要内容**：
- 二进制协议格式
- 消息头定义
- 消息体格式
- 字节序（网络字节序）

---

### 5.3 序列化方案

**文档路径**：`05-网络协议/03-序列化方案.md`

**主要内容**：
- HTTP：JSON（可读性好）
- TCP：Protobuf（性能优）
- 序列化性能对比
- 版本兼容性处理

---

### 5.4 加密方案

**文档路径**：`05-网络协议/04-加密方案.md`

**主要内容**：
- HTTPS（TLS/SSL）
- TCP 加密（可选）
- 敏感数据加密
- 签名验证

---

## 第六部分：部署运维

### 6.1 部署架构

**文档路径**：`06-部署运维/01-部署架构.md`

**主要内容**：

#### 部署拓扑
```
负载均衡器（Nginx）
    ↓
    ├── HTTP Server × 3
    └── TCP Server × 3
         ↓
    数据库集群
    ├── PostgreSQL（主从）
    ├── Redis（集群）
    └── MongoDB（副本集）
```

#### 服务器配置
- HTTP Server：4核8G，CentOS 8
- TCP Server：8核16G，CentOS 8
- 数据库：8核16G，SSD

---

### 6.2 配置管理

**文档路径**：`06-部署运维/02-配置管理.md`

**主要内容**：
- appsettings.json
- 环境变量
- 配置中心（可选）
- 配置热更新

---

### 6.3 监控告警

**文档路径**：`06-部署运维/03-监控告警.md`

**主要内容**：
- Prometheus + Grafana
- 关键指标监控
- 告警规则配置
- 性能分析

---

### 6.4 日志管理

**文档路径**：`06-部署运维/04-日志管理.md`

**主要内容**：
- Serilog 配置
- 结构化日志
- 日志级别
- 日志收集（ELK）

---

## 第七部分：开发指南

### 7.1 开发环境搭建

**文档路径**：`07-开发指南/01-开发环境搭建.md`

**主要内容**：
- .NET 8 SDK 安装
- Visual Studio / Rider 配置
- 数据库安装和初始化
- 本地开发配置

---

### 7.2 代码规范

**文档路径**：`07-开发指南/02-代码规范.md`

**主要内容**：
- C# 编码规范
- 命名规范
- 注释规范
- 异步编程规范

---

### 7.3 测试指南

**文档路径**：`07-开发指南/03-测试指南.md`

**主要内容**：
- 单元测试（xUnit）
- 集成测试
- 性能测试
- 压力测试

---

### 7.4 调试技巧

**文档路径**：`07-开发指南/04-调试技巧.md`

**主要内容**：
- Visual Studio 调试
- 日志调试
- 网络抓包
- 性能分析工具

---

## 附录

### 附录 A：术语表

| 术语 | 说明 |
|-----|------|
| HTTP Server | 基于 HTTP 协议的 Web 服务器 |
| TCP Server | 基于 TCP 协议的游戏服务器 |
| JWT | JSON Web Token，用于身份认证 |
| AOI | Area of Interest，视野范围 |
| ELO | 评分系统 |
| ORM | Object-Relational Mapping |

---

### 附录 B：参考资源

- [ASP.NET Core 文档](https://docs.microsoft.com/aspnet/core/)
- [Entity Framework Core](https://docs.microsoft.com/ef/core/)
- [Protobuf](https://developers.google.com/protocol-buffers)
- [Redis](https://redis.io/documentation)
- [PostgreSQL](https://www.postgresql.org/docs/)

---

## 文档维护

**文档负责人**：服务端技术团队

**更新频率**：
- 架构变更时必须更新
- 重要功能完成后更新
- 每个版本发布后整体审查

**版本历史**：

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|---------|--------|
| 1.0 | 2026-01-22 | 创建文档大纲 | System |

---

**下一步工作**：

1. ✅ 完成文档大纲
2. ⬜ 逐个章节编写详细文档
3. ⬜ 技术方案评审
4. ⬜ 原型开发验证
5. ⬜ 正式开发

---

**备注**：
- 本大纲覆盖了服务端的核心功能模块
- 每个章节都需要详细展开成独立文档
- 随着项目进展，大纲会持续更新完善
